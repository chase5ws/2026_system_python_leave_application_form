# 員工請假單生成系統
## 項目介紹
這是一個基於 Python 開發的圖形化員工請假單自動生成系統，支持員工信息查詢、假別選擇、日曆化請假日期挑選、請假時長自動計算，最終會復制原始請假單模板並填入數據，以「員工工號+請假單 Leave App Form.xlsx」命名生成獨立請假單文件，全程無需手動編輯 Excel，避免格式錯誤和人為疏漏。

## 功能特點
1.  **員工信息自動讀取**：從 `員工名單.xlsx` 中加載員工姓名、工號、部門信息，下拉選擇即可填充對應數據。
2.  **標準化假別選擇**：提供多種常見假別（均帶 `Leave` 後綴），單選選擇，格式統一。
3.  **日曆化日期選擇**：採用日曆控件挑選請假開始/結束日期，避免手動輸入日期的格式錯誤。
4.  **請假時長自動計算**：選擇結束日期後自動計算請假天數和時長（每天按 8 小時計算，超過 24 小時顯示天數統計），並校驗結束日期不得早於開始日期。
5.  **申請日期自動填入**：生成請假單時，自動在 `H5` 單元格填入當前系統日期作為申請日期。
6.  **模板復制與重命名**：復制原始請假單模板，不修改原文件格式，生成以員工工號命名的新請假單，便於歸檔和查詢。
7.  **圖形化操作界面**：直觀簡潔的 TKinter 界面，無需代碼基礎，普通用戶即可上手操作。

## 環境依賴
### 所需 Python 模塊
| 模塊名稱 | 作用 | 安裝指令 |
|----------|------|----------|
| `openpyxl` | 讀取和編寫 Excel 文件（.xlsx 格式） | `pip install openpyxl` |
| `tkinter` | 構建圖形化用戶界面（Python 自帶，無需單獨安裝） | - |
| `tkcalendar` | 提供日曆選擇控件，實現可視化日期挑選 | `pip install tkcalendar` |
| `PyInstaller`（可選） | 將 Python 腳本打包為 EXE 可執行文件 | `pip install pyinstaller` |

### 支持的系統環境
- Windows 7/10/11（推薦，打包後的 EXE 可直接運行）
- macOS/Linux（需安裝對應 Python 環境，界面顯示可能略有差異）

## 文件目錄結構
```
├── 員工請假單生成系統/
│   ├── leave_application.py       # 核心運行腳本（可自定義文件名）
│   ├── my_icon.ico                # EXE 打包自定義圖標（可選）
│   ├── config.txt                 # 配置文件（存儲 Excel 文件路徑）
│   ├── 員工名單.xlsx              # 員工信息數據源（必須包含「部門」「姓名」「工號」列）
│   ├── 請假單 Leave App Form.xlsx # 原始請假單模板（需提前配置好表格格式）
│   └── README.md                  # 項目說明文檔（本文檔）
```

## 快速上手
### 步驟 1：準備前置文件
1.  編輯 `員工名單.xlsx`：
    - 必須包含 3 個列名：「部門」「姓名」「工號」（列名不可修改，順序可調整）。
    - 填入對應員工信息，保存為 `.xlsx` 格式，放置在腳本同一目錄。
2.  準備 `請假單 Leave App Form.xlsx`：
    - 配置好請假單的固定格式（如字體、單元格合併、表頭等）。
    - 確保需自動填充的單元格（`H5`「申請日期」、`B6`「姓名」、`E6`「工號」、`I6`「部門」、`B8`「假別」、`B12`「請假說明」、`B24`「請假期間」、`I24`「合計」）無鎖定，放置在腳本同一目錄。
3.  （可選）準備 `my_icon.ico`：用於 EXE 打包的自定義圖標，尺寸推薦 256x256，放置在腳本同一目錄。

### 步驟 2：安裝依賴模塊
打開命令提示符（CMD）或終端，執行以下指令安裝所需依賴：
```bash
pip install openpyxl tkcalendar
```

### 步驟 3：運行系統
#### 方式 1：直接運行 Python 腳本
1.  打開 CMD/終端，切換到腳本所在目錄（例如 `cd C:\Users\compc\OneDrive\Desktop\請假單系統`）。
2.  執行運行指令：
    ```bash
    python leave_application.py
    ```
3.  彈出圖形化界面後，按照界面引導操作即可。

#### 方式 2：運行打包後的 EXE 文件
1.  參照「打包說明」將腳本打包為 EXE 文件。
2.  將 `config.txt`、`員工名單.xlsx`、`請假單 Leave App Form.xlsx` 復制到 EXE 文件同級目錄。
3.  雙擊 `員工請假單生成系統.exe` 即可啟動（無需安裝 Python 環境）。

### 步驟 4：界面操作流程
1.  **選擇員工**：從下拉框中挑選對應員工，部門和工號會自動填充顯示。
2.  **選擇假別**：單選對應的請假類型（如 `Menstruation Leave`、`Personal Leave` 等）。
3.  **填寫請假說明**：在文本框中輸入請假的具體原因或備註信息。
4.  **選擇請假日期**：
    - 點擊「請假開始日期」日曆控件，挑選請假起始日期。
    - 點擊「請假結束日期」日曆控件，挑選請假結束日期（選擇後自動計算請假合計時長）。
    - 若選擇的結束日期早於開始日期，系統會自動修正為同一天並給出提示。
5.  **生成請假單**：點擊「生成請假單」按鈕，等待彈出「成功」提示框。
6.  **查詢結果**：在腳本/EXE 同一目錄下，找到以「員工工號+請假單 Leave App Form.xlsx」命名的文件，打開即可查看填寫完成的請假單。

## 打包說明（生成 EXE 可執行文件）
### 核心打包指令
打開 CMD/終端，切換到腳本所在目錄，執行以下指令（支持自定義圖標 `my_icon.ico`）：
```bash
pyinstaller -F -w -i my_icon.ico --name "員工請假單生成系統" leave_application.py
```

### 指令參數說明
| 參數 | 含義 |
|------|------|
| `-F` | 單文件打包，生成一個獨立的 EXE 文件，便於傳輸和部署 |
| `-w` | 無控制台窗口運行，適用於圖形化界面程序，避免彈出黑框 |
| `-i my_icon.ico` | 指定 EXE 文件的自定義圖標，若無需自定義可替換為 `-i none` |
| `--name "員工請假單生成系統"` | 自定義 EXE 文件名稱，可根據需求修改 |
| `leave_application.py` | 你的核心 Python 腳本文件名（需與實際文件名一致） |

### 打包後處理
1.  打包完成後，在腳本所在目錄的 `dist` 文件夾中找到生成的 `員工請假單生成系統.exe`。
2.  將 `config.txt`、`員工名單.xlsx`、`請假單 Leave App Form.xlsx` 復制到 `員工請假單生成系統.exe` 同級目錄（**不可缺少**，否則 EXE 運行會報錯）。
3.  （可選）刪除打包過程中生成的 `build` 文件夾和 `員工請假單生成系統.spec` 文件，不影響 EXE 運行。

## 常見問題排查
1.  **運行/打包報錯「找不到模塊 openpyxl/tkcalendar」**
    - 解決方案：卸載並重新安裝對應模塊，確保模塊完整安裝：
      ```bash
      pip uninstall openpyxl tkcalendar -y
      pip install openpyxl tkcalendar
      ```
2.  **EXE 運行閃退，無任何提示**
    - 解決方案：暫時去掉打包指令中的 `-w` 參數，重新打包生成帶控制台窗口的 EXE，運行後查看控制台中的具體報錯信息（通常是缺少依賴文件或文件路徑錯誤）。
3.  **日曆控件無法顯示/日期選擇無響應**
    - 解決方案：確保已安裝最新版本的 `tkcalendar` 模塊：
      ```bash
      pip install --upgrade tkcalendar
      ```
4.  **生成的請假單缺少數據，部分單元格為空**
    - 解決方案：
      1.  確認 `員工名單.xlsx` 中的列名為「部門」「姓名」「工號」，無錯別字。
      2.  確認原始請假單模板 `請假單 Leave App Form.xlsx` 中的目標單元格（`H5`、`B6` 等）存在且未被保護。
      3.  確認選擇員工和假別後再點擊「生成請假單」。
5.  **自定義圖標 `my_icon.ico` 不生效**
    - 解決方案：
      1.  確認圖標文件格式為 `.ico`，尺寸推薦 256x256，且與腳本在同一目錄。
      2.  確認打包指令中 `-i my_icon.ico` 參數無拼寫錯誤。
      3.  刷新 Windows 文件夾緩存或重啟電腦，查看圖標是否更新。

## 注意事項
1.  所有核心文件（`config.txt`、`員工名單.xlsx`、`請假單 Leave App Form.xlsx`）必須與腳本/EXE 在同一目錄，否則會導致文件找不到錯誤。
2.  原始請假單模板 `請假單 Leave App Form.xlsx` 運行前請關閉，避免文件被占用無法復制。
3.  生成的請假單文件會覆蓋同目錄下同名文件（同一員工多次生成請假單會覆蓋舊文件），請及時歸檔重要文件。
4.  若需修改請假時長計算規則（如每天工作時長），可修改腳本中的 `calculate_total_hours_auto` 方法，調整 `total_hours = delta_days * 8` 中的「8」為對應時長。
5.  若需新增假別，可在腳本的 `build_ui` 方法中，在 `leave_types` 列表中按照「假別名稱+ Leave」的格式添加對應選項。

## 版本更新說明
- 初始版本：實現核心請假單生成功能，支持手動輸入日期和手動計算時長。
- 優化版本 1：新增日曆日期選擇控件，實現請假時長自動計算。
- 優化版本 2：新增申請日期自動填入（`H5` 單元格），校驗結束日期合法性，假別統一添加 `Leave` 後綴。
- 優化版本 3：優化 Excel 模板復制邏輯，支持以員工工號命名新文件，提升文件歸檔便捷性。

## 免責聲明
1.  本系統僅用於內部員工請假單生成，不適用於商業用途。
2.  使用者需自行確保 `員工名單.xlsx` 中的員工信息保密性，開發者不承擔信息洩露帶來的任何責任。
3.  若因模板文件格式錯誤、依賴環境缺失或操作不當導致的數據丟失，開發者不承擔對應責任。
